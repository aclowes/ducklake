# name: test/sql/transaction/transaction_inlining.test
# description: Test inlining support within a transaction
# group: [transaction]

require ducklake

require parquet

require icu

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_files_s1', DATA_INLINING_ROW_LIMIT 1000 )

statement ok
USE ducklake

statement ok
BEGIN TRANSACTION;

statement ok
CREATE TABLE repro_table (yr int );

statement ok
ALTER TABLE repro_table SET PARTITIONED BY (yr);

statement ok
INSERT INTO repro_table
  SELECT year(ts) as yr
  FROM generate_series( now() - INTERVAL '10 minutes',
                        now(),
                        INTERVAL '5 minutes' ) AS t(ts);

statement ok
COMMIT;

query I
FROM repro_table;
----
2025
2025
2025